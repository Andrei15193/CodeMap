{% assign directory_path_size = page.path.size | minus: page.name.size %}
{% assign directory_path = page.path | slice: 0, directory_path_size %}
<div class="container p-0">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 no-gutters" style="margin-right: -1.5rem;">
        {% for subdirectory_index_page in site.pages %}
            {% if subdirectory_index_page.path.size > page.path.size and subdirectory_index_page.name contains 'index.' %}
                {% assign subdirectory_name_size = subdirectory_index_page.path.size | minus: directory_path_size | minus: subdirectory_index_page.name.size %}
                {% assign subdirectory_name = subdirectory_index_page.path | slice: directory_path_size, subdirectory_name_size | split: '/' | first %}
                {% assign expected_subdirectory_path = directory_path | append: subdirectory_name | append: '/' | append: subdirectory_index_page.name %}
                {% if subdirectory_index_page.path == expected_subdirectory_path %}
                    <div class="col pb-3 pr-4">
                        <div class="card bg-light h-100">
                            <div class="card-header">{{ subdirectory_index_page.title }}</div>
                            {% if subdirectory_index_page.card_relative_url %}
                            <img src="{{ directory_path | append: subdirectory_name | append: '/' | append: subdirectory_index_page.card_relative_url | relative_url }}" alt="{{ subdirectory_index_page.title }} card">
                            {% endif %}
                            <div class="card-body d-flex flex-column">
                                <p class="card-text">{{ subdirectory_index_page.excerpt }}</p>
                                <div class="mt-auto text-right">
                                    <a href="{{ subdirectory_index_page.url }}" class="btn btn-sm btn-primary" style="text-align: right">{{ include.button_label | default: 'View Page' }}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
</div>