{% if include.directory_path %}
    {% assign directory_path = include.directory_path | join: '/' %}
{% else %}
    {% assign directory_path = page.path | split: '/' %}
    {% assign directory_path = directory_path | reverse | slice: 1, directory_path.size | reverse | join: '/' %}
{% endif %}
<div class="container p-0">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 no-gutters" style="margin-right: -1.5rem;">
        {% for subdirectory_index_page in site.pages %}
            {% assign subdirectory_path = subdirectory_index_page.path | split: '/' %}
            {% assign subdirectory_path = subdirectory_path | reverse | slice: 1, subdirectory_path.size | reverse %}

            {% assign directory_path_other = subdirectory_path | reverse | slice: 1, subdirectory_path.size | reverse | join: '/' %}
            {% if directory_path == directory_path_other %}
                <div class="col pb-3 pr-4">
                    <div class="card bg-light h-100">
                        <div class="card-header">{{ subdirectory_index_page.title }}</div>
                        {% if subdirectory_index_page.card_relative_url %}
                            <img src="{{ subdirectory_path | join: '/' | append: '/' | append: subdirectory_index_page.card_relative_url | relative_url }}" alt="{{ subdirectory_index_page.title }} card">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            {% if subdirectory_index_page.tags and subdirectory_index_page.tags.size > 0 %}
                            <p>
                                {% for tag in subdirectory_index_page.tags %}
                                    <span class="badge badge-pill badge-primary">{{ tag }}</span>
                                {% endfor %}
                            </p>
                            {% endif %}

                            <p class="card-text">{{ subdirectory_index_page.excerpt }}</p>
                            <div class="mt-auto text-right">
                                <a href="{{ subdirectory_index_page.url | relative_url }}" class="btn btn-sm btn-primary">{{ include.button_label | default: 'View Page' }}</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>