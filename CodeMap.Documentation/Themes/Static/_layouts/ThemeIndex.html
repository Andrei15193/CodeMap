---
layout: Bootstrap@4.5.0
---
{% assign directory_path = page.path | split: '/' %}
{% assign directory_path = directory_path | reverse | slice: 1, directory_path.size | reverse %}

{% assign parent_index_page_path = directory_path | reverse | slice: 1, directory_path.size | reverse | join: '/' | append: '/index.md' %}
{% assign grandparent_index_page_path = directory_path | reverse | slice: 2, directory_path.size | reverse | join: '/' | append: '/index.md' %}
{% assign codemap_handlebars_version = directory_path | reverse | slice: 3 | first %}

{% assign theme_version_index_pages_info = '' | split: ',' | where: 'an', 'array: [tuple theme_index_pageInfo: [page, theme_version: string]]' %}
{% for theme_version_index_page in site.pages %}
    {% if theme_version_index_page.name == 'index.md' %}
        {% assign theme_version_index_page_directory_path = theme_version_index_page.path | split: '/' %}
        {% assign theme_version_index_page_directory_path = theme_version_index_page_directory_path | reverse | slice: 1, theme_version_index_page_directory_path.size | reverse %}

        {% assign theme_version_index_page_parent_index_page_path = theme_version_index_page_directory_path | reverse | slice: 1, theme_version_index_page_directory_path.size | reverse | join: '/' | append: '/index.md' %}
        {% if page.path == theme_version_index_page_parent_index_page_path %}
            {% assign theme_version_string = theme_version_index_page_directory_path | last %}

            {% assign theme_build_version_split = theme_version_string | split: '+' %}
            {% if theme_build_version_split.size > 1 %}
                {% assign theme_build_version_string = theme_build_version_split | slice: 1, theme_build_version_split.size | join: '+' %}
            {% else %}
                {% assign theme_build_version_string = nil %}
            {% endif %}

            {% assign theme_pre_release_version_split = theme_build_version_split | first | split: '-' %}
            {% assign theme_base_version_string = theme_pre_release_version_split | first %}
            {% if theme_pre_release_version_split.size > 1 %}
                {% assign theme_pre_release_version_string = theme_pre_release_version_split | slice: 1, theme_pre_release_version_split.size | join: '-' %}
            {% else %}
                {% assign theme_pre_release_version_string = nil %}
            {% endif %}

            {% assign theme_base_version = theme_base_version_string | split: '.' %}
            {% assign theme_semver = '' | split: ',' | where: 'a', 'SemVer' %}
            {% for base_version_identifier in theme_base_version %}
                {% assign base_version_number_identifier = base_version_identifier | plus: 0 %}
                {% if base_version_identifier == '0' or base_version_number_identifier > 0 %}
                    {% assign theme_semver = theme_semver | push: base_version_number_identifier %}
                {% endif %}
            {% endfor %}

            {% if theme_semver.size == 3 %}
                {% if theme_pre_release_version_string %}
                    {% assign theme_pre_release_version = theme_pre_release_version_string | split: '.' %}

                    {% assign theme_semver = theme_semver | push: 2 %}
                    {% for theme_pre_release_version_identifier in theme_pre_release_version %}
                        {% assign theme_pre_release_version_number_identifier = theme_pre_release_version_identifier | plus: 0 %}
                        {% if theme_pre_release_version_identifier == '0' or theme_pre_release_version_number_identifier > 0 %}
                            {% assign theme_semver = theme_semver | push: 0 | push: theme_pre_release_version_number_identifier %}
                        {% else %}
                            {% assign theme_semver = theme_semver | push: 1 | push: theme_pre_release_version_identifier %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% assign theme_semver = theme_semver | push: 4 %}
                {% endif %}

                {% if theme_build_version_string %}
                    {% assign theme_build_version = theme_build_version_string | split: '.' %}

                    {% assign theme_semver = theme_semver | push: 3 %}
                    {% for theme_build_version_identifier in theme_build_version %}
                        {% assign theme_build_version_number_identifier = theme_build_version_identifier | plus: 0 %}
                        {% if theme_build_version_identifier == '0' or theme_build_version_number_identifier > 0 %}
                            {% assign theme_semver = theme_semver | push: 0 | push: theme_build_version_number_identifier %}
                        {% else %}
                            {% assign theme_semver = theme_semver | push: 1 | push: theme_build_version_identifier %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% assign theme_semver = theme_semver | push: 4 %}
                {% endif %}

                {%
                    assign theme_index_page_info = '' | split: ',' | where: 'a', 'theme_index_page_info'
                        | push: theme_version_index_page
                        | push: theme_version_string
                        | push: theme_semver
                %}
                {% assign theme_version_index_pages_info = theme_version_index_pages_info | push: theme_index_page_info %}
            {% endif %}
        {% endif %}
    {% endif %}
{% endfor %}

{% for offset in (1..theme_version_index_pages_info.size) %}
    {% assign max_theme_index_page_info = theme_version_index_pages_info | slice: forloop.index0 | first %}
    {% assign theme_version_index_pages_info_not_sorted = '' | split: ',' | where: 'an', 'array: [theme_index_page_info]' %}

    {% for theme_index_page_info in theme_version_index_pages_info offset: offset %}
        {% assign is_current_greater = nil %}

        {% assign max_versioned_themes_index_page_semver = max_theme_index_page_info[2] %}
        {% assign versioned_themes_index_page_semver = theme_index_page_info[2] %}
        {% assign min_semver_length = max_versioned_themes_index_page_semver.size %}
        {% if versioned_themes_index_page_semver.size < min_semver_length %}
            {% assign min_semver_length = versioned_themes_index_page_semver.size %}
        {% endif %}

        {% for semver_part_index in (0..min_semver_length) limit: min_semver_length %}
            {% if versioned_themes_index_page_semver[semver_part_index] > max_versioned_themes_index_page_semver[semver_part_index] %}
                {% assign is_current_greater = true %}
                {% break %}
            {% elsif max_versioned_themes_index_page_semver[semver_part_index] > versioned_themes_index_page_semver[semver_part_index] %}
                {% assign is_current_greater = false %}
                {% break %}
            {% endif %}
        {% endfor %}

        {% if is_current_greater == nil %}
            {% if max_versioned_themes_index_page_semver.size < versioned_themes_index_page_semver.size %}
                {% assign is_current_greater = true %}
            {% else %}
                {% assign is_current_greater = false %}
            {% endif %}
        {% endif %}

        {% if is_current_greater %}
            {% assign theme_version_index_pages_info_not_sorted = theme_version_index_pages_info_not_sorted | push: max_theme_index_page_info %}
            {% assign max_theme_index_page_info = theme_index_page_info %}
        {% else %}
            {% assign theme_version_index_pages_info_not_sorted = theme_version_index_pages_info_not_sorted | push: theme_index_page_info %}
        {% endif %}
    {% endfor %}

    {% assign theme_version_index_pages_info = theme_version_index_pages_info | slice: 0, forloop.index0 | push: max_theme_index_page_info %}
    {% for theme_index_page_info_not_sorted in theme_version_index_pages_info_not_sorted %}
        {% assign theme_version_index_pages_info = theme_version_index_pages_info | push: theme_index_page_info_not_sorted %}
    {% endfor %}
{% endfor %}


{% assign empty_array = '' | split: ',' | where: 'an', 'array: []' %}
{% assign all_tags = '' | split: ',' | where: 'an', 'array: [string]' %}

{% assign page_tags = page.tags | default: empty_array %}
{% assign all_tags = all_tags | concat: page_tags %}
{% for theme_version_index_page_info in theme_version_index_pages_info %}
    {% assign theme_version_index_page = theme_version_index_page_info[0] %}
    {% assign theme_version_index_page_tags = theme_version_index_page.tags | default: empty_array %}
    {% assign all_tags = all_tags | concat: theme_version_index_page_tags | uniq %}
{% endfor %}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        {% for page in site.pages %}
            {% if page.path == grandparent_index_page_path %}
                <li class="breadcrumb-item" aria-current="page">
                    <a href="{{ page.url | relative_url }}" title="CodeMap.Handlebars@{{ codemap_handlebars_version }}">{{ page.title }}@{{ codemap_handlebars_version }}</a>
                </li>
                {% break %}
            {% endif %}
        {% endfor %}
        {% for page in site.pages %}
            {% if page.path == parent_index_page_path %}
                <li class="breadcrumb-item" aria-current="page">
                    <a href="{{ page.url | relative_url }}">{{ page.title }}</a>
                </li>
                {% break %}
            {% endif %}
        {% endfor %}
        <li class="breadcrumb-item active" aria-current="page">
            {{ page.title }}
        </li>
    </ol>
</nav>

<h2>{{ page.title }}</h2>

{% if all_tags.size > 0 %}
    <div>
        {% for tag in all_tags %}
            <span class="badge badge-pill badge-primary">{{ tag }}</span>
        {% endfor %}
    </div>
{% endif %}

{{ content }}

{% assign latest_theme_version_index_page_info = theme_version_index_pages_info | first %}
{% assign latest_theme_version_index_page = latest_theme_version_index_page_info[0] %}
{% assign latest_theme_version = latest_theme_version_index_page_info[1] %}

<p>View the latest <a href="{{ latest_theme_version_index_page.url | relative_url }}">{{ latest_theme_version_index_page.title }}@{{ latest_theme_version }}</a> theme, for older versions check the <a href="#all-versions">all versions</a> list.</p>

{% include {{ directory_path | join: '/' | append: '/files.html' | replace: ' ', '-' | replace: '+', '_' }} %}

<h3 id="all-versions">All versions</h3>

<ul>
{% for theme_version_index_page_info in theme_version_index_pages_info %}
    {% assign theme_version_index_page = theme_version_index_page_info[0] %}
    {% assign theme_version = theme_version_index_page_info[1] %}
    <li><a href="{{ theme_version_index_page.url | relative_url }}">{{ theme_version_index_page.title }}@{{ theme_version }}</a></li>
{% endfor %}
</ul>