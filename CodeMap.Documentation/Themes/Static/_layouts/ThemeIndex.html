---
layout: Bootstrap@4.5.0
---
{% assign directory_path = page.path | split: '/' %}
{% assign directory_path = directory_path | reverse | slice: 1, directory_path.size | reverse %}

{% assign parent_index_page_path = directory_path | reverse | slice: 1, directory_path.size | reverse | join: '/' | append: '/index.md' %}
{% assign grandparent_index_page_path = directory_path | reverse | slice: 2, directory_path.size | reverse | join: '/' | append: '/index.md' %}
{% assign codemap_handlebars_version = directory_path | reverse | slice: 3 | first %}

{% assign theme_version_index_pages_info = '' | split: ',' | where: 'an', 'array: [tuple theme_index_pageInfo: [page, theme_version: string]]' %}
{% for theme_version_index_page in site.pages %}
    {% if theme_version_index_page.name == 'index.md' %}
        {% assign theme_version_index_page_directory_path = theme_version_index_page.path | split: '/' %}
        {% assign theme_version_index_page_directory_path = theme_version_index_page_directory_path | reverse | slice: 1, theme_version_index_page_directory_path.size | reverse %}

        {% assign theme_version_index_page_parent_index_page_path = theme_version_index_page_directory_path | reverse | slice: 1, theme_version_index_page_directory_path.size | reverse | join: '/' | append: '/index.md' %}
        {% if page.path == theme_version_index_page_parent_index_page_path %}
            {% assign theme_version = theme_version_index_page_directory_path | reverse | first %}
            {%
                assign theme_version_index_page_info = '' | split: ',' | where: 'a', 'theme_index_pageInfo'
                    | push: theme_version_index_page
                    | push: theme_version
            %}
            {% assign theme_version_index_pages_info = theme_version_index_pages_info | push: theme_version_index_page_info %}
        {% endif %}
    {% endif %}
{% endfor %}

{% assign sorted_theme_version_index_pages_info = '' | split: ',' | where: 'an', 'array: [theme_index_pageInfo]' %}
{% for index in (1..theme_version_index_pages_info.size) %}
    {% assign theme_version_index_pages_info_new = '' | split: ',' | where: 'an', 'array: [theme_index_pageInfo]' %}
    {% assign max_theme_version_index_pages_info = theme_version_index_pages_info | first %}
    {% for theme_version_index_page_info in theme_version_index_pages_info offset: 1 %}
        {% assign max_theme_version = max_theme_version_index_pages_info[1] %}
        {% assign max_theme_version_parts = max_theme_version | split: '.' %}
        {% assign theme_version = theme_version_index_page_info[1] %}
        {% assign theme_version_parts = theme_version | split: '.' %}

        {% assign is_theme_version_greater = false %}
        {% for version_part_index in (0..2) %}
            {% assign max_theme_version_part = max_theme_version_parts[version_part_index] | add: 0 %}
            {% assign theme_version_part = theme_version_parts[version_part_index] | add: 0 %}

            {% if theme_version_part > max_theme_version_part %}
                {% assign is_theme_version_greater = true %}
                {% break %}
            {% elsif theme_version_part < max_theme_version_part %}
                {% break %}
            {% endif %}
        {% endfor %}

        {% if is_theme_version_greater %}
            {% assign theme_version_index_pages_info_new = theme_version_index_pages_info_new | push: max_theme_version_index_pages_info %}
            {% assign max_theme_version_index_pages_info = theme_version_index_page_info %}
        {% else %}
            {% assign theme_version_index_pages_info_new = theme_version_index_pages_info_new | push: theme_version_index_page_info %}
        {% endif %}
    {% endfor %}

    {% assign theme_version_index_pages_info = theme_version_index_pages_info_new %}
    {% assign sorted_theme_version_index_pages_info = sorted_theme_version_index_pages_info | push: max_theme_version_index_pages_info %}
{% endfor %}


{% assign empty_array = '' | split: ',' | where: 'an', 'array: []' %}
{% assign all_tags = '' | split: ',' | where: 'an', 'array: [string]' %}

{% assign page_tags = page.tags | default: empty_array %}
{% assign all_tags = all_tags | concat: page_tags %}
{% for theme_version_index_page_info in sorted_theme_version_index_pages_info %}
    {% assign theme_version_index_page = theme_version_index_page_info[0] %}
    {% assign theme_version_index_page_tags = theme_version_index_page.tags | default: empty_array %}
    {% assign all_tags = all_tags | concat: theme_version_index_page_tags | uniq %}
{% endfor %}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        {% for page in site.pages %}
            {% if page.path == grandparent_index_page_path %}
                <li class="breadcrumb-item" aria-current="page">
                    <a href="{{ page.url | relative_url }}" title="CodeMap.Handlebars@{{ codemap_handlebars_version }}">{{ page.title }}@{{ codemap_handlebars_version }}</a>
                </li>
                {% break %}
            {% endif %}
        {% endfor %}
        {% for page in site.pages %}
            {% if page.path == parent_index_page_path %}
                <li class="breadcrumb-item" aria-current="page">
                    <a href="{{ page.url | relative_url }}">{{ page.title }}</a>
                </li>
                {% break %}
            {% endif %}
        {% endfor %}
        <li class="breadcrumb-item active" aria-current="page">
            {{ page.title }}
        </li>
    </ol>
</nav>

<h2>{{ page.title }}</h2>

{% if all_tags.size > 0 %}
    <div>
        {% for tag in all_tags %}
            <span class="badge badge-pill badge-primary">{{ tag }}</span>
        {% endfor %}
    </div>
{% endif %}

{{ content }}

{% assign latest_theme_version_index_page_info = sorted_theme_version_index_pages_info | first %}
{% assign latest_theme_version_index_page = latest_theme_version_index_page_info[0] %}
{% assign latest_theme_version = latest_theme_version_index_page_info[1] %}

<p>View the latest <a href="{{ latest_theme_version_index_page.url | relative_url }}">{{ latest_theme_version_index_page.title }}@{{ latest_theme_version }}</a> theme, for olderver versions check the <a href="#all-versions">all versions</a> list.</p>

{% include {{ directory_path | join: '/' | append: '/files.html' | replace: ' ', '-' }} %}

<h3 id="all-versions">All versions</h3>

<ul>
{% for theme_version_index_page_info in sorted_theme_version_index_pages_info %}
    {% assign theme_version_index_page = theme_version_index_page_info[0] %}
    {% assign theme_version = theme_version_index_page_info[1] %}
    <li><a href="{{ theme_version_index_page.url | relative_url }}">{{ theme_version_index_page.title }}@{{ theme_version }}</a></li>
{% endfor %}
</ul>