---
layout: Bootstrap@4.5.0
---
{% comment %}
enum Precedence {
    Release = 4,
    Build = 3,
    PreRelease = 2,
    TextIdentifier = 1,
    NumberIdentifier = 0
}

tuple: SemVer [
    major: number >= 0,
    minor: number >= 0,
    patch: number >= 0,
    { release version => Precedence.Release (4), pre-release version => Precedence.PreRelease (2) }
    ...[
        if (identifier is number and >= 0)
            ...[ Precedence.NumberIdentifier (0), identifier as number ]
        else
            ...[ Precedence.TextIdentifier (1), identifier ]
    ],
    { without build version => Precedence.Release (4), with build version => Precedence.Build (3) }
    ...[
        if (identifier is number and >= 0)
            ...[ Precedence.NumberIdentifier (0), identifier as number ]
        else
            ...[ Precedence.TextIdentifier (1), identifier ]
    ]
]

A SemVer tuple is an array of items where the first 3 are the base version identifiers, always numeric identifiers (these are number greater than or equal to 0)
followed by the version precedence (release = 4, pre-release = 2)
followed by the pre-release version identifier pairs made out of the precedence for text or number identifiers then the identifier itself accordingly
followed by the version precedence (release = 4, build = 3)
followed by the build version identifier pairs which are just like the pre-release version identifier pairs

When comparing any two versions, values at the same index have the same type, thus numbers are compared with numbers and strings with strings.
To determine which version has precedence over another simply compare the individual items lexicographically.

Example:
1.0.0                  => [1, 0, 0, Release   , Release]
1.0.0-alpha            => [1, 0, 0, PreRelease, TextIdentifier, 'alpha'       ]
1.0.0-alpha.1          => [1, 0, 0, PreRelease, TextIdentifier, 'alpha'       , NumberIdentifier, 1               , Release]
1.0.0-alpha.1+build.1  => [1, 0, 0, PreRelease, TextIdentifier, 'alpha'       , NumberIdentifier, 1               , Build  , TextIdentifier, 'build', NumberIdentifier, 1]
1.0.0-alpha+build      => [1, 0, 0, PreRelease, TextIdentifier, 'alpha'       , Build           , TextIdentifier  , 'build']
1.0.0+build            => [1, 0, 0, Release   , Build         , TextIdentifier, 'build']
1.0.0+build.1          => [1, 0, 0, Release   , Build         , TextIdentifier, 'build'         , NumberIdentifier, 1      ]
1.0.0+build.2          => [1, 0, 0, Release   , Build         , TextIdentifier, 'build'         , NumberIdentifier, 2      ]
2.0.0                  => [2, 0, 0, Release   , Release]
{% endcomment %}

{% assign directory_path = page.path | split: '/' %}
{% assign directory_path = directory_path | reverse | slice: 1, directory_path.size | reverse %}

{% assign current_codemap_handlebars_version_string = directory_path | reverse | slice: 1 | first %}
{% assign codemap_handlebars_path = directory_path | reverse | slice: 2, directory_path.size | reverse | join: '/' %}

{% assign versioned_themes_index_pages_info = '' | split: ',' | where: 'an', 'array: [tuple versioned_themes_index_page_info: [page, codemap_handlebars_version_string: string, codemap_handlebars_version: SemVer]' %}
{% assign other_themes_index_pages_info = '' | split: ',' | where: 'an', 'array: [tuple other_themes_index_page_info: [page, codemap_handlebars_version_string: string]]' %}
{% for themes_version_index_page in site.pages %}
    {% if themes_version_index_page.name == 'index.md' %}
        {% assign themes_version_index_page_directory_path = themes_version_index_page.path | split: '/' %}
        {% assign themes_version_index_page_directory_path = themes_version_index_page_directory_path | reverse | slice: 1, themes_version_index_page_directory_path.size | reverse %}

        {% assign codemap_handlebars_path_other = themes_version_index_page_directory_path | reverse | slice: 2, themes_version_index_page_directory_path.size | reverse | join: '/' %}
        {% if codemap_handlebars_path == codemap_handlebars_path_other %}
            {% assign codemap_handlebars_version_string = themes_version_index_page_directory_path | reverse | slice: 1 | first %}

            {% assign codemap_handlebars_build_version_split = codemap_handlebars_version_string | split: '+' %}
            {% if codemap_handlebars_build_version_split.size > 1 %}
                {% assign codemap_handlebars_build_version_string = codemap_handlebars_build_version_split | slice: 1, codemap_handlebars_build_version_split.size | join: '+' %}
            {% else %}
                {% assign codemap_handlebars_build_version_string = nil %}
            {% endif %}

            {% assign codemap_handlebars_pre_release_version_split = codemap_handlebars_build_version_split | first | split: '-' %}
            {% assign codemap_handlebars_base_version_string = codemap_handlebars_pre_release_version_split | first %}
            {% if codemap_handlebars_pre_release_version_split.size > 1 %}
                {% assign codemap_handlebars_pre_release_version_string = codemap_handlebars_pre_release_version_split | slice: 1, codemap_handlebars_pre_release_version_split.size | join: '-' %}
            {% else %}
                {% assign codemap_handlebars_pre_release_version_string = nil %}
            {% endif %}

            {% assign codemap_handlebars_base_version = codemap_handlebars_base_version_string | split: '.' %}
            {% assign codemap_handlebars_semver = '' | split: ',' | where: 'a', 'SemVer' %}
            {% for base_version_identifier in codemap_handlebars_base_version %}
                {% assign base_version_number_identifier = base_version_identifier | plus: 0 %}
                {% if base_version_identifier == '0' or base_version_number_identifier > 0 %}
                    {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: base_version_number_identifier %}
                {% endif %}
            {% endfor %}

            {% if codemap_handlebars_semver.size == 3 %}
                {% if codemap_handlebars_pre_release_version_string %}
                    {% assign codemap_handlebars_pre_release_version = codemap_handlebars_pre_release_version_string | split: '.' %}

                    {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 2 %}
                    {% for codemap_handlebars_pre_release_version_identifier in codemap_handlebars_pre_release_version %}
                        {% assign codemap_handlebars_pre_release_version_number_identifier = codemap_handlebars_pre_release_version_identifier | plus: 0 %}
                        {% if codemap_handlebars_pre_release_version_identifier == '0' or codemap_handlebars_pre_release_version_number_identifier > 0 %}
                            {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 0 | push: codemap_handlebars_pre_release_version_number_identifier %}
                        {% else %}
                            {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 1 | push: codemap_handlebars_pre_release_version_identifier %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 4 %}
                {% endif %}

                {% if codemap_handlebars_build_version_string %}
                    {% assign codemap_handlebars_build_version = codemap_handlebars_build_version_string | split: '.' %}

                    {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 3 %}
                    {% for codemap_handlebars_build_version_identifier in codemap_handlebars_build_version %}
                        {% assign codemap_handlebars_build_version_number_identifier = codemap_handlebars_build_version_identifier | plus: 0 %}
                        {% if codemap_handlebars_build_version_identifier == '0' or codemap_handlebars_build_version_number_identifier > 0 %}
                            {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 0 | push: codemap_handlebars_build_version_number_identifier %}
                        {% else %}
                            {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 1 | push: codemap_handlebars_build_version_identifier %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% assign codemap_handlebars_semver = codemap_handlebars_semver | push: 4 %}
                {% endif %}

                {%
                    assign versioned_themes_index_page_info = '' | split: ',' | where: 'a', 'versioned_themes_index_page_info'
                        | push: themes_version_index_page
                        | push: codemap_handlebars_version_string
                        | push: codemap_handlebars_semver
                %}
                {% assign versioned_themes_index_pages_info = versioned_themes_index_pages_info | push: versioned_themes_index_page_info %}
            {% else %}
                {%
                    assign other_themes_index_page_info = '' | split: ',' | where: 'a', 'other_themes_index_page_info'
                        | push: themes_version_index_page
                        | push: codemap_handlebars_version_string
                %}
                {% assign other_themes_index_pages_info = other_themes_index_pages_info | push: other_themes_index_page_info %}
            {% endif %}
        {% endif %}
    {% endif %}
{% endfor %}

{% for offset in (1..versioned_themes_index_pages_info.size) %}
    {% assign max_versioned_themes_index_page_info = versioned_themes_index_pages_info | slice: forloop.index0 | first %}
    {% assign versioned_themes_index_pages_info_not_sorted = '' | split: ',' | where: 'an', 'array: [versioned_themes_index_page_info]' %}

    {% for versioned_themes_index_page_info in versioned_themes_index_pages_info offset: offset %}
        {% assign is_current_greater = nil %}

        {% assign max_versioned_themes_index_page_semver = max_versioned_themes_index_page_info[2] %}
        {% assign versioned_themes_index_page_semver = versioned_themes_index_page_info[2] %}

        {% assign min_semver_length = max_versioned_themes_index_page_semver.size %}
        {% if versioned_themes_index_page_semver.size < min_semver_length %}
            {% assign min_semver_length = versioned_themes_index_page_semver.size %}
        {% endif %}

        {% for semver_part_index in (0..min_semver_length) limit: min_semver_length %}
            {% if versioned_themes_index_page_semver[semver_part_index] > max_versioned_themes_index_page_semver[semver_part_index] %}
                {% assign is_current_greater = true %}
                {% break %}
            {% elsif max_versioned_themes_index_page_semver[semver_part_index] > versioned_themes_index_page_semver[semver_part_index] %}
                {% assign is_current_greater = false %}
                {% break %}
            {% endif %}
        {% endfor %}

        {% if is_current_greater == nil %}
            {% if max_versioned_themes_index_page_semver.size < versioned_themes_index_page_semver.size %}
                {% assign is_current_greater = true %}
            {% else %}
                {% assign is_current_greater = false %}
            {% endif %}
        {% endif %}

        {% if is_current_greater %}
            {% assign versioned_themes_index_pages_info_not_sorted = versioned_themes_index_pages_info_not_sorted | push: max_versioned_themes_index_page_info %}
            {% assign max_versioned_themes_index_page_info = versioned_themes_index_page_info %}
        {% else %}
            {% assign versioned_themes_index_pages_info_not_sorted = versioned_themes_index_pages_info_not_sorted | push: versioned_themes_index_page_info %}
        {% endif %}
    {% endfor %}

    {% assign versioned_themes_index_pages_info = versioned_themes_index_pages_info | slice: 0, forloop.index0 | push: max_versioned_themes_index_page_info %}
    {% for versioned_themes_index_page_info_not_sorted in versioned_themes_index_pages_info_not_sorted %}
        {% assign versioned_themes_index_pages_info = versioned_themes_index_pages_info | push: versioned_themes_index_page_info_not_sorted %}
    {% endfor %}
{% endfor %}

{% for offset in (1..other_themes_index_pages_info.size) %}
    {% assign min_other_themes_index_page_info = other_themes_index_pages_info | slice: forloop.index0 | first %}
    {% assign other_themes_index_pages_info_not_sorted = '' | split: ',' | where: 'an', 'array: [other_themes_index_page_info]' %}

    {% for other_themes_index_page_info in other_themes_index_pages_info offset: offset %}
        {% assign min_other_themes_index_page_version = min_other_themes_index_page_info[1] %}
        {% assign other_themes_index_page_version = other_themes_index_page_info[1] %}

        {% if other_themes_index_page_version < min_other_themes_index_page_version %}
            {% assign other_themes_index_pages_info_not_sorted = other_themes_index_pages_info_not_sorted | push: min_other_themes_index_page_info %}
            {% assign min_other_themes_index_page_info = other_themes_index_page_info %}
        {% else %}
            {% assign other_themes_index_pages_info_not_sorted = other_themes_index_pages_info_not_sorted | push: other_themes_index_page_info %}
        {% endif %}
    {% endfor %}

    {% assign other_themes_index_pages_info = other_themes_index_pages_info | slice: 0, forloop.index0 | push: min_other_themes_index_page_info %}
    {% for other_themes_index_page_info_not_sorted in other_themes_index_pages_info_not_sorted %}
        {% assign other_themes_index_pages_info = other_themes_index_pages_info | push: other_themes_index_page_info_not_sorted %}
    {% endfor %}
{% endfor %}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active" aria-current="page">
            <span title="CodeMap.Handlebars@{{ current_codemap_handlebars_version_string }}">{{ page.title }}@{{ current_codemap_handlebars_version_string }}</span>
        </li>
    </ol>
</nav>

<h2>
    {{ page.title }}
    <div class="btn-group">
        <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            CodeMap.Handlebars@{{ current_codemap_handlebars_version_string }}
        </button>
        <div class="dropdown-menu">
            {% for versioned_themes_index_page_info in versioned_themes_index_pages_info %}
                {% assign themes_version_index_page = versioned_themes_index_page_info[0] %}
                {% assign codemap_handlebars_version_string = versioned_themes_index_page_info[1] %}
                <a class="dropdown-item{% if codemap_handlebars_version_string == current_codemap_handlebars_version_string %} active{% endif %}" href="{{ themes_version_index_page.url | relative_url }}">CodeMap.Handlebars@{{ codemap_handlebars_version_string }}</a>
            {% endfor %}
            {% if versioned_themes_index_pages_info.size > 0 and other_themes_index_page_info.size > 0 %}
                <div class="dropdown-divider"></div>
            {% endif %}
            {% for other_themes_index_page_info in other_themes_index_pages_info %}
                {% assign themes_version_index_page = other_themes_index_page_info[0] %}
                {% assign codemap_handlebars_version_string = other_themes_index_page_info[1] %}
                <a class="dropdown-item{% if codemap_handlebars_version_string == current_codemap_handlebars_version_string %} active{% endif %}" href="{{ themes_version_index_page.url | relative_url }}">CodeMap.Handlebars@{{ codemap_handlebars_version_string }}</a>
            {% endfor %}
        </div>
    </div>
</h2>

{{ content }}

{% include {{ directory_path | join: '/' | append: '/files.html' | replace: ' ', '-' | replace: '@', '-' | replace: '+', '_' }} %}